---
title: UE5 самописные инструменты
description: Разработка аналога asset library для Unreal Engine 5
author: cotes
date: 2024-06-01 12:00:00 +0800
image:
  path: /assets/arch_tools/4.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
  alt: 
---
Инструментов было много, документировать их долго, опишу самое интересное.


# Библиотека ассетов/материалов

В blender, twinmotion, lumion и d5 есть такая прекрасная штука - библиотека стандартных ассетов/материалов, которую можно использовать в любом проекте, не боясь переполнить диск лавочками да деревьями.

В Unreal Engine 5 таких систем нет (спойлер: почти нет), поэтому нужно было либо страдать без неё, либо писать самому.

Перед непосредственным описанием процесса разработки и функционала инструмента, считаю нужным более развернуто объяснить, зачем оно, собственно, нужно и так ли это критично.
## Зачем?
Во многих случаях у опытных архитектурных визуализаторов библиотека растительности/предметов/материалов может занимать 30-200гб. Они могут
1. Сделать проект с библиотекой стартовым, что будет дублировать его для каждого нового проекта
2. Использовать 1 проект на протяжении всей карьеры, добавляя новые сцены для каждого заказа

Оба варианта - нежелательны, по очевидным причинам[^footnote]. Нашел третий - content plugins.
### Content plugins
По сути, позволяет запаковать всю библиотеку ассетов в плагин. Чтобы получить доступ к ассетам из любого проекта - нужно просто его активировать.
Это примерно то, как работают подобные библиотеки в большинстве вышеперечисленных софтов.

Можно было бы на этом и остановиться, но только при одном условии - обеспечение backwards/forward compatability, в данном случае - forwards (новые версии библиотеки не должны ломать проекты, использующие старую).

## Как эту проблему решили конкуренты
Большая часть крупных програмных продуктов в этой сфере выпускают обновления этих библиотек раз в год, что дает им предостаточно времени, чтобы отполировать все мастер материалы, настроить совместимые интерфесы взаимодествия с ними и удостовериться в том, что изменение не полвияет на конечного пользователя.

Для студий визуализации такое сложновато. И набор ассетов должен обновляться чаще и трястись над совместимостью разных версий не хочется.
Но хочется иметь возможность открыть любой проект студии не боясь, что изменение библиотек его сломало, при этом не копируя всю библиотеку в каждый проект.

## Гибридный подход
Хочется
1. Иметь возможность достать любой предмет библиотеки в любом проекте UE5 без необходимости копирования 200гб в свежую папку
2. Сделать так, чтобы обновления не ломали старые проекты

### Описание решения
1. В отдельном проекте разработать и наполнить, собственно, библиотеку
2. Встроенными инструментами конвертировать её в content plugin
3. Активировать plugin в любом проекте, где необходим данный набор предметов
4. После окончания работы над проектом использовать скрипт (unreal editor utility widget), который: 
>  1. Проходиться по всем сценам (Levels) законченного проекта
>  2. Находит объекты из библиотеки, которые реально были использованы в сценах проекта (размещены в любой из сцен)
>  3. Дублирует все использованные библиотечные объекты в локальную папку проекта
>  4. Заменяет все бибилотечные объекты на локальные во всех сценах 

### Пользовательский интерфейс 

На этом этапе система уже технически работоспособна, осталось только сделать её использование более удобным 

При использовании content plugins, unreal engine дает доступ к папке библиотеки, которую можно добавить в панель "избранное" для более быстрого доступа
![image1](./assets/arch_tools/1.png) 

У этого подхода остается только 1 проблема.
Отображение папок в content browser практически невозможно кастомизировать

Из-за чего поиск папок по первичному визуальному осмотру значительно затруднен (по сравнению с аналогичными програмными продуктами)
К примеру. Найдите здесь папку leather с материалами кожи
![image1](./assets/arch_tools/2.png) 

И, та же самая директори, но с самописным пользовательским интерфейсом, с использованием editor utility widgets
В данный момент существует 2 имплементации:
1. Кнопки, переключают тебя по папкам content browser
2. Кнопки переключают тебя по генерируемым изображениям предпросмотра с самописными реакциями на клик и перетаскивание
![image1](./assets/arch_tools/4.png) 


[^footnote]: Если причины не очевидны:
    > 1. Дупликация - Занимает много места, невозможно синхронизировать с командой
    > 2. 1 проект - Получиться сверх взаимосвязанный монолит. Изменение одного мастер материала сломает все 30 под-проектов и будет требовать перенастройки для повторного использования


